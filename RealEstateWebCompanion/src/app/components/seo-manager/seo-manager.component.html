<div class="seo-manager">
  <div class="header">
    <h2>SEO Manager</h2>
    <div class="actions">
      <button class="btn btn-help" (click)="toggleHelp()" title="Help & Getting Started">
        Help
      </button>
      <button class="btn btn-success" (click)="addRow()">
        + Add Page
      </button>
      <button class="btn btn-info" (click)="manualImportUrls()" title="Recommended: Paste your site's URLs">
        üìù Manual Import (Recommended)
      </button>
      <button class="btn btn-outline-info" (click)="preloadPages()" title="Try auto-discovery (may be blocked by CORS)">
        üîç Auto Discover
      </button>
      @if (websiteUrl) {
        <button class="btn btn-outline" (click)="changeWebsiteUrl()" title="Change website URL">
          üåê Change URL
        </button>
      }
      @if (rowData.length > 0) {
        <button class="btn btn-danger" (click)="clearAllRecords()" title="Clear all SEO records">
          üóëÔ∏è Clear All
        </button>
      }
      <button class="btn btn-warning" (click)="generateSitemap()">
        Generate Sitemap XML
      </button>
      @if (googleDriveFolderUrl) {
        <div class="button-group">
          <button class="btn btn-primary" (click)="exportData()" title="Export SEO data to local file">
            üì§ Export from SEO Manager
          </button>
          <button class="btn btn-success" (click)="openGoogleDriveToUpload()" title="Open Google Drive to upload exported file">
            ‚¨ÜÔ∏è Put into SeguinDev Drive
          </button>
        </div>
        <div class="button-group">
          <button class="btn btn-primary" (click)="quickImportFromSeguinDev()" title="Download SEO file from SeguinDev Google Drive">
            üì• Get from SeguinDev Drive
          </button>
          <label class="btn btn-secondary" title="Import SEO data from local file">
            üìã Import to SEO Manager
            <input type="file" accept=".json" (change)="importData($event)" style="display: none;">
          </label>
        </div>
      } @else {
        <button class="btn btn-primary" (click)="exportData()">
          Export SEO Data (JSON)
        </button>
        <label class="btn btn-secondary">
          Import SEO Data (JSON)
          <input type="file" accept=".json" (change)="importData($event)" style="display: none;">
        </label>
      }
    </div>
  </div>
  
  <div class="info-panel">
    <h3>SEO Management</h3>
    <p>Manage your website's pages with SEO metadata including titles, meta descriptions, and sitemap configuration.</p>
    @if (websiteUrl) {
      <p class="website-url"><strong>Configured Website:</strong> <span class="url-display">{{ websiteUrl }}</span></p>
    } @else {
      <p class="no-url"><strong>Quick Start:</strong> Click "Manual Import" to set your website URL and add your pages.</p>
    }
    <p><strong>Recommended Workflow:</strong></p>
    <ul style="margin-top: 5px; color: #6c757d;">
      <li><strong>Manual Import (Recommended):</strong> Paste your site's navigation URLs - works reliably every time</li>
      <li><strong>Auto Discover:</strong> Attempts to fetch sitemap.xml or homepage - often blocked by browser CORS policy</li>
      <li><strong>Clear All:</strong> Remove all existing records to start fresh with correct pages</li>
    </ul>
    <ul>
      <li><strong>Page Name:</strong> Internal identifier for the page</li>
      <li><strong>Page URL:</strong> The URL path for the page (e.g., /about, /contact)</li>
      <li><strong>Page Title:</strong> The title that appears in browser tabs and search results</li>
      <li><strong>Meta Name:</strong> The name attribute for meta tags</li>
      <li><strong>Meta Description:</strong> Description shown in search engine results</li>
      <li><strong>Change Frequency:</strong> How often the page is updated (for sitemap.xml)</li>
      <li><strong>Priority:</strong> Page priority from 0.0 to 1.0 (for sitemap.xml)</li>
    </ul>
  </div>

  @if (showExportInstructions) {
    <div class="help-overlay" (click)="closeExportInstructions()">
      <div class="help-dialog" (click)="$event.stopPropagation()">
        <div class="help-header">
          <h3>üì§ How to Export SEO Data to SeguinDev</h3>
          <button class="close-btn" (click)="closeExportInstructions()">‚úï</button>
        </div>
        <div class="help-content">
          <section>
            <h4>üöÄ Quick 3-Step Process</h4>
            
            <div class="help-method">
              <h5>üîπ Step 1: Export SEO Data</h5>
              <p>Click the <strong>"Export SEO Data (JSON)"</strong> button above</p>
              <ul>
                <li>This will download a file named <strong>"seo-data.json"</strong> to your computer</li>
                <li>The file will be saved in your Downloads folder</li>
                <li>This file contains all your current SEO pages and metadata</li>
              </ul>
            </div>

            <div class="help-method">
              <h5>üîπ Step 2: Open Google Drive Folder</h5>
              <p>Click the <strong>"üìÇ Open Seguin Google Drive Folder"</strong> button</p>
              <ul>
                <li>This will open the shared Google Drive folder in a new browser tab</li>
                <li>Make sure you're signed in with your Google account that has access</li>
              </ul>
            </div>

            <div class="help-method">
              <h5>üîπ Step 3: Upload to Google Drive</h5>
              <p>In the Google Drive folder:</p>
              <ul>
                <li>Look for the existing <strong>"seomanager.json"</strong> file (if any)</li>
                <li>Right-click in the folder and select <strong>"File upload"</strong> or drag & drop</li>
                <li>Select the <strong>"seo-data.json"</strong> file from your Downloads folder</li>
                <li>Optional: Rename it to <strong>"seomanager.json"</strong> to replace the old version</li>
                <li>The file is now available to share with others!</li>
              </ul>
            </div>

            <div class="help-note">
              <p><strong>‚úÖ That's it!</strong> Your SEO data is now backed up to Google Drive and can be shared with your team.</p>
            </div>
          </section>
        </div>
      </div>
    </div>
  }

  @if (showImportInstructions) {
    <div class="help-overlay" (click)="closeImportInstructions()">
      <div class="help-dialog" (click)="$event.stopPropagation()">
        <div class="help-header">
          <h3>üì• How to Import SEO Data from SeguinDev</h3>
          <button class="close-btn" (click)="closeImportInstructions()">‚úï</button>
        </div>
        <div class="help-content">
          <section>
            <h4>üöÄ Quick 3-Step Process</h4>
            
            <div class="help-method">
              <h5>üîπ Step 1: Open Google Drive Folder</h5>
              <p>Click the <strong>"üìÇ Open Seguin Google Drive Folder"</strong> button below</p>
              <ul>
                <li>This will open the shared Google Drive folder in a new browser tab</li>
                <li>Make sure you're signed in with your Google account that has access to the shared folder</li>
              </ul>
            </div>

            <div class="help-method">
              <h5>üîπ Step 2: Download the SEO File</h5>
              <p>In the Google Drive folder:</p>
              <ul>
                <li>Look for the file named <strong>"seomanager.json"</strong></li>
                <li>Right-click the file and select <strong>"Download"</strong></li>
                <li>The file will be saved to your computer's Downloads folder</li>
              </ul>
            </div>

            <div class="help-method">
              <h5>üîπ Step 3: Import into SEO Manager</h5>
              <p>Back on this page:</p>
              <ul>
                <li>Click the <strong>"Import SEO Data (JSON)"</strong> button</li>
                <li>A file picker window will open - navigate to your Downloads folder:
                  <ul>
                    <li><strong>Quick way:</strong> Click "Downloads" in the left sidebar</li>
                    <li><strong>Or:</strong> Type "Downloads" in the location/address bar</li>
                    <li><strong>Or:</strong> Navigate to <code>C:\Users\[YourName]\Downloads</code></li>
                  </ul>
                </li>
                <li>Find and select the <strong>"seomanager.json"</strong> file (may show as "seomanager (1).json" if downloaded multiple times)</li>
                <li>Click <strong>"Open"</strong> - the SEO data will be imported automatically!</li>
              </ul>
              <p><strong>üí° Tip:</strong> If you downloaded the file multiple times, use the most recent version (highest number in parentheses).</p>
            </div>

            <div class="help-note">
              <p><strong>‚úÖ That's it!</strong> Your SEO data is now loaded and ready to use.</p>
            </div>
          </section>
        </div>
      </div>
    </div>
  }

  @if (showHelp) {
    <div class="help-overlay" (click)="closeHelp()">
      <div class="help-dialog" (click)="$event.stopPropagation()">
        <div class="help-header">
          <h3>üöÄ SEO Manager - Getting Started Guide</h3>
          <button class="close-btn" (click)="closeHelp()">‚úï</button>
        </div>
        <div class="help-content">
          <section>
            <h4>üìç Step 1: Choose Your Method to Load Pages</h4>
            <div class="help-method">
              <h5>‚úÖ Manual Import (Recommended)</h5>
              <p><strong>Why use this:</strong> This method works 100% of the time and gives you full control over which pages are added.</p>
              <p><strong>How to use:</strong></p>
              <ol>
                <li>Click the <strong>"üìù Manual Import"</strong> button</li>
                <li>Enter your website URL (e.g., https://montreal4rent.com)</li>
                <li>Paste your page URLs, one per line. For example:
                  <pre>/
/apartments
/contact-us
/about</pre>
                </li>
                <li>Click OK - pages will be created with recommended SEO values</li>
              </ol>
            </div>
            
            <div class="help-method">
              <h5>üîç Auto Discover (May Be Blocked)</h5>
              <p><strong>Why use this:</strong> Attempts to automatically find pages from your sitemap.xml or homepage.</p>
              <p><strong>Limitation:</strong> Most browsers block this due to CORS (Cross-Origin Resource Sharing) security policy.</p>
              <p><strong>How to use:</strong></p>
              <ol>
                <li>Click the <strong>"üîç Auto Discover"</strong> button</li>
                <li>Enter your website URL</li>
                <li>The system will try to fetch your sitemap.xml or parse your homepage</li>
                <li><strong>If it fails:</strong> A dialog will suggest using Manual Import instead - click OK to proceed</li>
              </ol>
            </div>
          </section>

          <section>
            <h4>üìÑ Understanding Sitemap XML</h4>
            <p><strong>What it is:</strong> A sitemap.xml file tells search engines (Google, Bing) about all the pages on your website.</p>
            <p><strong>How to use it:</strong></p>
            <ol>
              <li>Add all your pages using Manual Import or Add Page</li>
              <li>Fill in the SEO metadata (titles, descriptions, etc.)</li>
              <li>Click <strong>"Generate Sitemap XML"</strong></li>
              <li>A sitemap.xml file will download to your computer</li>
              <li><strong>Upload this file</strong> to your website's root directory (e.g., https://yoursite.com/sitemap.xml)</li>
              <li>Submit the sitemap URL to <a href="https://search.google.com/search-console" target="_blank">Google Search Console</a> and <a href="https://www.bing.com/webmasters" target="_blank">Bing Webmaster Tools</a></li>
            </ol>
            <p><strong>Benefits:</strong> Helps search engines discover and index your pages faster, improving your SEO.</p>
          </section>

          <section>
            <h4>üíæ Export SEO Data</h4>
            <p><strong>Purpose:</strong> Save all your SEO data to a JSON file as a backup or to share with team members.</p>
            <p><strong>When to use:</strong></p>
            <ul>
              <li>Before making major changes (create a backup)</li>
              <li>To transfer SEO data between environments (dev, staging, production)</li>
              <li>To share your SEO configuration with other team members</li>
              <li>As a regular backup of your SEO metadata</li>
            </ul>
            <p><strong>How to use:</strong> Click <strong>"Export SEO Data (JSON)"</strong>.</p>
            <p><strong>üí° Note:</strong> If you have configured a Google Drive folder in preferences.json, exports will automatically save to your Google Drive folder. Otherwise, files will download to your computer.</p>
          </section>

          <section>
            <h4>üì• Import SEO Data</h4>
            <p><strong>Purpose:</strong> Load previously saved SEO data from a JSON file.</p>
            <p><strong>When to use:</strong></p>
            <ul>
              <li>Restore from a backup</li>
              <li>Load SEO data created in another environment</li>
              <li>Import SEO configuration from a team member</li>
              <li>Recover from accidental deletion (if you have a backup)</li>
            </ul>
            <p><strong>How to use:</strong></p>
            <ul>
              <li><strong>From Google Drive:</strong> If configured, click <strong>"üì• Import from Google Drive"</strong> to load the latest version from your Drive folder</li>
              <li><strong>From Local File:</strong> Click <strong>"Import SEO Data (JSON)"</strong> and select your JSON file</li>
            </ul>
            <p><strong>‚ö†Ô∏è Warning:</strong> Importing will replace your current data. Export first if you want to keep your current data!</p>
          </section>

          <section>
            <h4>üéØ Quick Start Workflow</h4>
            <ol>
              <li>Click <strong>Manual Import</strong> to add your pages</li>
              <li>Use the <strong>Edit</strong> button to refine SEO metadata for each page</li>
              <li>Click <strong>Export SEO Data</strong> to create a backup</li>
              <li>Click <strong>Generate Sitemap XML</strong> to create your sitemap</li>
              <li>Upload sitemap.xml to your website and submit to search engines</li>
            </ol>
          </section>
        </div>
      </div>
    </div>
  }

  @if (isEditing && editingPage) {
    <div class="edit-form-overlay">
      <div class="edit-form">
        <h3>Edit SEO Page</h3>
        <form>
          <div class="form-group">
            <label for="pageName">Page Name:</label>
            <input type="text" id="pageName" [(ngModel)]="editingPage.pageName" name="pageName" class="form-control">
          </div>
          <div class="form-group">
            <label for="pageUrl">Page URL:</label>
            <input type="text" id="pageUrl" [(ngModel)]="editingPage.pageUrl" name="pageUrl" class="form-control">
          </div>
          <div class="form-group">
            <label for="title">Page Title:</label>
            <input type="text" id="title" [(ngModel)]="editingPage.title" name="title" class="form-control">
          </div>
          <div class="form-group">
            <label for="metaName">Meta Name:</label>
            <input type="text" id="metaName" [(ngModel)]="editingPage.metaName" name="metaName" class="form-control">
          </div>
          <div class="form-group">
            <label for="metaDescription">Meta Description:</label>
            <textarea id="metaDescription" [(ngModel)]="editingPage.metaDescription" name="metaDescription" class="form-control" rows="4"></textarea>
          </div>
          <div class="form-group">
            <label for="changeFrequency">Change Frequency:</label>
            <select id="changeFrequency" [(ngModel)]="editingPage.changeFrequency" name="changeFrequency" class="form-control">
              @for (freq of changeFrequencyOptions; track freq) {
                <option [value]="freq">{{ freq }}</option>
              }
            </select>
          </div>
          <div class="form-group">
            <label for="priority">Priority (0.0 - 1.0):</label>
            <input type="number" id="priority" [(ngModel)]="editingPage.priority" name="priority" class="form-control" min="0" max="1" step="0.1">
          </div>
          <div class="form-actions">
            <button type="button" class="btn btn-primary" (click)="saveEdit()">Save</button>
            <button type="button" class="btn btn-secondary" (click)="cancelEdit()">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  }
  
  <ag-grid-angular
    style="width: 100%; height: 500px;"
    class="ag-theme-alpine"
    [rowData]="rowData"
    [columnDefs]="colDefs"
    [defaultColDef]="defaultColDef"
    [gridOptions]="gridOptions"
    (gridReady)="onGridReady($event)"
    (cellValueChanged)="onCellValueChanged($event)"
  />
</div>
